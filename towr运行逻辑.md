![](md/é€»è¾‘/rosgraph.png)

## 1. `O` (Optimize motion)

### ğŸ§© 1. `RobotModel` (æ¨¡å‹æ„å»º)

**ä»£ç è¡Œï¼š**
```cpp
formulation_.model_ = RobotModel(static_cast<RobotModel::Robot>(msg.robot));
````

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**
> **`formulation_`**ï¼šè¿™æ˜¯ä¼˜åŒ–é—®é¢˜çš„æ€»å®šä¹‰å¯¹è±¡ã€‚
> æ­¤å¤„é€šè¿‡å·¥å‚æ¨¡å¼æ„é€  `model_`ï¼Œå†…éƒ¨åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š**è¿åŠ¨å­¦æ¨¡å‹** (`Kinematic`) å’Œ **åŠ¨åŠ›å­¦æ¨¡å‹** (`Dynamic`)ã€‚

-----
>eg:src/towr/towr/include/towr/models/examples/biped_model.h

#### ğŸ¦µ 1.1 è¿åŠ¨å­¦æ¨¡å‹ (`xxxKinematicModel`)

*ç»§æ‰¿è‡ª `KinematicModel`ï¼Œå®šä¹‰â€œèº«æâ€ä¸â€œæ´»åŠ¨èŒƒå›´â€ã€‚*

  * **åˆå§‹åŒ–å‚æ•° 1ï¼šè…¿éƒ¨æ•°é‡**

    ```cpp
    KinematicModel(2)
    ```

    * **å«ä¹‰**ï¼šåˆå§‹åŒ–çˆ¶ç±»ï¼Œå‘ŠçŸ¥ç³»ç»Ÿâ€œæˆ‘æ˜¯ä¸€ä¸ª **2æ¡è…¿** (Endeffectors) çš„æœºå™¨äººâ€ã€‚

  * **åˆå§‹åŒ–å‚æ•° 2ï¼šåä¹‰ç«™ç«‹å§¿æ€ (`nominal_stance_`)**

    ```cpp
    const double z_nominal_b = -0.65; // èº«é«˜/è…¿é•¿
    const double y_nominal_b =  0.20; // åŠè·¨å®½

    nominal_stance_.at(L) << 0.0,  y_nominal_b, z_nominal_b; // å·¦è„š
    nominal_stance_.at(R) << 0.0, -y_nominal_b, z_nominal_b; // å³è„š
    ```

      * **å«ä¹‰**ï¼šå®šä¹‰æœºå™¨äººæœ€è‡ªç„¶ã€é»˜è®¤çš„ç«™ç«‹å§¿æ€ï¼ˆç›¸å¯¹äº Base ä¸­å¿ƒï¼‰ã€‚
      * **å‚æ•°è§£æ**ï¼š
          * `z = -0.65`: è„šåœ¨èº«ä½“ä¸‹æ–¹ **0.65ç±³**ã€‚
          * `y = Â±0.20`: ä¸¤è„šé—´è·æ€»å®½ **0.4ç±³**ã€‚

    > ğŸ¤– **ç‰©ç†ç”»é¢æ„Ÿ**
    > æƒ³è±¡æœºå™¨äººæ‚¬åœ¨åŠç©ºä¸­ï¼Œèº«ä½“ä¸­å¿ƒæ˜¯åŸç‚¹ `(0,0,0)`ã€‚è¿™ä¸¤è¡Œä»£ç æŠŠå®ƒçš„ä¸¤åªè„šâ€œæ‘†â€åˆ°äº†å®ƒè¯¥åœ¨çš„ç©ºé—´ä½ç½®ã€‚

  * **åˆå§‹åŒ–å‚æ•° 3ï¼šæœ€å¤§æ´»åŠ¨èŒƒå›´ (`max_dev_from_nominal_`)**

    ```cpp
    max_dev_from_nominal_ << 0.25, 0.15, 0.15;
    ```

      * **å«ä¹‰**ï¼šå®šä¹‰è…¿çš„å·¥ä½œç©ºé—´ï¼ˆWorkspaceï¼‰ï¼Œå‘Šè¯‰ä¼˜åŒ–å™¨è…¿ä¸èƒ½æ— é™ä¼¸é•¿ã€‚
      * **é™åˆ¶èŒƒå›´**ï¼ˆç›¸å¯¹äºåä¹‰ä½ç½®ï¼‰ï¼š
          * **Xè½´ (å‰å)**: $\pm 0.25m$ (è¿ˆæ­¥/è¹¬åœ°æé™)
          * **Yè½´ (å·¦å³)**: $\pm 0.15m$ (æ‘†åŠ¨æé™)
          * **Zè½´ (ä¸Šä¸‹)**: $\pm 0.15m$ (ä¸‹è¹²/æè…¿æé™)

-----

#### âš–ï¸ 1.2 åŠ¨åŠ›å­¦æ¨¡å‹ (`xxxDynamicModel`)

*ç»§æ‰¿è‡ª `SingleRigidBodyDynamics`ï¼Œå®šä¹‰â€œä½“é‡â€ä¸â€œä½“è´¨â€ã€‚*

**æ„é€ å‡½æ•°ï¼š**

```cpp
: SingleRigidBodyDynamics(20, 1.209, 5.583, 6.056, 0.005, -0.190, -0.012, 2)
```

1.  **è´¨é‡ (Mass)**

      * **å€¼**ï¼š`20` (kg)
      * **ä½œç”¨**ï¼šåŸºäº $F=ma$ï¼Œå†³å®šäº†ä¼˜åŒ–å™¨éœ€è¦è®¡ç®—å¤šå¤§çš„æ¨åŠ›æ¥é©±åŠ¨æœºå™¨äººã€‚

2.  **è½¬åŠ¨æƒ¯é‡ (Inertia Tensor)**

      * **å€¼**ï¼š`1.209, 5.583, 6.056, ...`

      * **å«ä¹‰**ï¼šè¿™ 6 ä¸ªæ•°å€¼æ„æˆäº† $3 \times 3$ çš„å¯¹ç§°æƒ¯æ€§çŸ©é˜µ $I$ï¼š

        $$
        I = \begin{bmatrix} I_{xx} & I_{xy} & I_{xz} \\ I_{yx} & I_{yy} & I_{yz} \\ I_{zx} & I_{zy} & I_{zz} \end{bmatrix}
        $$

      * **ä¸»å¯¹è§’çº¿** (`1.209`, `5.583`, `6.056`)ï¼šå¯¹åº” $I_{xx}, I_{yy}, I_{zz}$ã€‚æ•°å€¼è¶Šå¤§ï¼Œç»•è¯¥è½´è½¬åŠ¨è¶Šéš¾ã€‚

      * **éå¯¹è§’çº¿** (`0.005`, ...): æƒ¯æ€§ç§¯ï¼Œè¡¨ç¤ºè´¨é‡åˆ†å¸ƒçš„ä¸å¯¹ç§°æ€§ã€‚

3.  **è…¿éƒ¨è®¡æ•°**

      * **å€¼**ï¼š`2`
      * **ä½œç”¨**ï¼šå†æ¬¡ç¡®è®¤è…¿éƒ¨æ•°é‡ï¼Œç”¨äºæ¥è§¦åŠ›å˜é‡åˆå§‹åŒ–ã€‚

-----
